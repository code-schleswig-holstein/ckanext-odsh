{% import 'macros/form.html' as form %}
{% resource 'odsh/bootstrap-multiselect.js' %}
{% resource 'odsh/odsh_form.js' %}

<!-- field title -->
{% block package_basic_fields_title %}
{% set error_string = _(_('Title') + ': '+errors.title[0]) if errors.title %}
{{ form.input('title', id='field-title', label=_('Title'), value=data.title,
error=error_string, classes=['control-full'], attrs={'data-module': 'slug-preview-target'},
is_required=true,placeholder=_('Enter title')) }}
{% endblock %}

{% block package_basic_fields_url %}
{% set prefix = h.url_for(controller='package', action='read', id='') %}
{% set domain = h.url_for(controller='package', action='read', id='', qualified=true) %}
{% set domain = domain|replace("http://", "")|replace("https://", "") %}
{% set attrs = {'data-module': 'slug-preview-slug', 'data-module-prefix': domain, 'data-module-placeholder': '<dataset>'}
    %}

    <!-- field name -->
    {{ form.prepend('name', id='field-name', label=_('URL'), prepend=prefix,
    value=data.name, error=errors.name, attrs=attrs, is_required=true) }}
    {% endblock %}

    <!-- field notes -->
    {% block package_basic_fields_description %}
    {% set error_string = _(_('Description') + ': '+errors.notes[0]) if errors.notes %}
    {{ form.markdown('notes', id='field-notes', label=_('Description'), value=data.notes,
    error=error_string, is_required=true, placeholder=_('Enter description')) }}
    {% endblock %}


    <!-- field license -->

    <label class="control-label" for="field-license">
        {{ _("License") }}:
        <span title="{{ _("This field is required") }}" class="control-required">*</span>
    </label>
    <div class='row-fluid'>
        <div class='span3'>
            {% block package_basic_fields_license %}
            <div class="control-group">
                {% set error = errors.license_id %}
                <div class="controls">
                    <select id="field-license" name="license_id">
                        {% set existing_license_id = data.get('license_id') %}
                        {% for license_id, license_desc in h.license_options(existing_license_id) %}
                        <option value="{{ license_id }}" {% if existing_license_id==license_id %}selected="selected" {%
                            endif %}>{{ license_desc }}</option>
                        {% endfor %}
                    </select>
                    {% if error %}<span class="error-block">{{ error }}</span>{% endif %}
                </div>
            </div>
        </div>
        <div class='span3'>
            <!-- field Namensnennung -->
            {{ form.input_raw('access_constraints', id='field-licence-name', value=data.access_constraints,
            error=errors.access_constraints,
            classes=['control-full'],type='text',is_required=true,attrs={'disabled':true,
            'data-module':"odsh_form", 'data-module-licensetoggle':'true' }, placeholder=_('enter name')) }}
        </div>
	<div class="span6 inline-error">
	  {{error}}
	</div>
    </div>

    {% endblock %}

    <!-- timerange -->
    {% set error_string = _(_('Temporal end') + ': '+errors.temporal_end[0]) if errors.temporal_end %}
    <label for="start-end" class="control-label">{{ _('timerange') }}:
      <span title="{{ _("This field is required") }}" class="control-required">*</span>
    </label>
    <div class='row-fluid'>
        <div id='start-end' class='span3'>
            <!-- field temporal_start -->
            {% set temporal_start_label=_('odsh_temporal_start_label') %}
            {{ form.input_raw('temporal_start', id='field-temporal-start', value=data.temporal_start,
            error=errors.temporal_start,
            classes=['control-full'],type='date',is_required=true,placeholder=_('from'))
            }}
        </div>
        <div class='span3'>
            <!-- field temporal_end -->
            {% set temporal_end_label='Ende des Zeitraumes' %}
            {{ form.input_raw('temporal_end', id='field-temporal-end', value=data.temporal_end,
            error=errors.temporal_end, classes=['control-full'],type='date',is_required=true, placeholder=_('to'))
            }}
        </div>
	<div class="span6 inline-error">
	  {{error_string}}
	</div>
    </div>

    <!-- field publish date -->
    {% set publish_date_value=h.odsh_now() %}
    {% set error_string = _('odsh_publish_date_error_label') if errors.publish_date %}
    <!-- if form_style != 'edit' && !%} -->
    <!-- value=data.get('extras').publish_date, -->
    {% set publish_date_label='Ver√∂ffentlichungsdatum'%}
    {{ form.input('publish_date', id='field-publish-date', label=publish_date_label,
    value=publish_date_value,
    error=error_string, classes=['control-full'],type='date',is_required=true) }}


    <!-- field tags -->
    {% block package_basic_fields_tags %}
    {% set tag_attrs = {'data-module': 'autocomplete', 'data-module-tags': '', 'data-module-source':
    '/api/2/util/tag/autocomplete?incomplete=?'} %}
    {{ form.input('tag_string', id='field-tags', label=_('Tags'), value=data.tag_string, error=errors.tag_string,
    classes=['control-full'], attrs=tag_attrs,
    is_required=true, placeholder=_('odsh tags placeholder')) }}
    {% endblock %}

    {% block package_basic_fields_org %}
    {% set existing_org = data.owner_org or data.group_id %}
    <input id="field-organizations" name="owner_org" type="hidden" value="{{ existing_org }}" />
    {% endblock %}

    <!-- field spatial_extension -->
    {% set error_string = _('odsh_spatial_extension_error_label') if errors.spatial_extension %}
    {{ form.input('spatial_extension', id='field-spatial-extension', label=_('Spatial extension'),
    value=data.spatial_extension,
    error=error_string, classes=['control-full'],type='text',is_required=true,
    placeholder=_('Enter spatial extension')) }}

    <!-- field private -->
    <div class="control-group">
        <label for="field-private" class="control-label">{{ _('Visibility') }}:
            <span title="{{ _("This field is required") }}" class="control-required">*</span>
        </label>
        <div class="controls">
	  <div class="row-fluid">
	    <div class="span6">
              <select id="field-private" name="private">
                {% for option in [('True', _('Private')), ('False', _('Public'))] %}
                <option value="{{ option[0] }}" {% if option[0]==data.private|trim %}selected="selected" {% endif %}>{{
                  option[1] }}</option>
                {% endfor %}
              </select>
	    </div>
	  </div>
        </div>
    </div>


    {% if data.id and h.check_access('package_delete', {'id': data.id}) and data.state != 'active' %}
    <div class="control-group">
        <label for="field-state" class="control-label">{{ _('State') }}</label>
        <div class="controls">
	  <div class="row-fluid">
	    <div class="span6">
              <select id="field-state" name="state">
		<option value="active" {% if data.get('state', 'none' )=='active' %} selected="selected" {% endif %}>{{
                  _('Active') }}</option>
		<option value="deleted" {% if data.get('state', 'none' )=='deleted' %} selected="selected" {% endif %}>{{
                  _('Deleted') }}</option>
              </select>
	    </div>
	  </div>
        </div>
    </div>
    {% endif %}
